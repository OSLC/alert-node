'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.requiresAuth = exports.login = undefined;

require('isomorphic-fetch');

var _authHeader = require('auth-header');

var authorization = _interopRequireWildcard(_authHeader);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

/* global fetch, Response */
var login = exports.login = function login(idp) {
  return fetch(idp, { method: 'HEAD', credentials: 'include' }).then(function (resp) {
    return resp.headers.get('user');
  }).then(function (webId) {
    return webId ? { authType: 'WebID-TLS', idp: idp, webId: webId } : null;
  });
};

var requiresAuth = exports.requiresAuth = function requiresAuth(resp) {
  if (resp.status !== 401) {
    return false;
  }
  var wwwAuthHeader = resp.headers.get('www-authenticate');
  if (!wwwAuthHeader) {
    return false;
  }
  var auth = authorization.parse(wwwAuthHeader);
  return auth.scheme === 'WebID-TLS';
};